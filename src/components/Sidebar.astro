---
import { getRelativeLocaleUrl } from "astro:i18n";

// Get the current locale from Astro
const currentLocale = Astro.currentLocale || "en";

// Strip the locale prefix from the current path to get the base path
const currentPathWithoutLocale = Astro.url.pathname
  .replace(/^\/pt-br\//, "") // Remove pt-br prefix if it exists
  .replace(/^\//, ""); // Remove leading slash

// Generate URLs for each language while preserving the current path
const enUrl = currentPathWithoutLocale ? `/${currentPathWithoutLocale}` : "/";
const ptBrUrl = `/${currentLocale === "pt-br" && !currentPathWithoutLocale ? "" : "pt-br/"}${currentPathWithoutLocale}`;

// Create locale-specific navigation URLs
const homeURL =
  currentLocale === "en" ? "/" : getRelativeLocaleUrl(currentLocale, "");
const aboutURL = getRelativeLocaleUrl(currentLocale, "about");
const postsURL = getRelativeLocaleUrl(currentLocale, "posts");

// Translate sidebar items based on locale
const translations = {
  en: {
    writing: "Writing",
    about: "About",
    posts: "Posts",
  },
  "pt-br": {
    writing: "Artigos",
    about: "Sobre",
    posts: "Postagens",
  },
};

// Get the appropriate translations
const t =
  translations[currentLocale as keyof typeof translations] || translations.en;
---

<div class="sidebar-container">
  <div class="language-switcher">
    <a
      href={enUrl}
      class={`language-link ${currentLocale === "en" ? "active" : ""}`}
    >
      EN
    </a>
    <span class="language-divider">|</span>
    <a
      href={ptBrUrl}
      class={`language-link ${currentLocale === "pt-br" ? "active" : ""}`}
    >
      PT-BR
    </a>
  </div>

  <ul class="sidebar">
    <li><a href={homeURL}>{t.writing}</a></li>
  </ul>
</div>

<style>
  .sidebar-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .language-switcher {
    display: flex;
    gap: 0.5rem;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .language-link {
    text-decoration: none;
    color: #666;
    font-size: 0.9rem;
  }

  .language-link.active {
    font-weight: bold;
    color: #333;
  }

  .language-link:hover {
    text-decoration: underline;
  }

  .language-divider {
    color: #ccc;
  }

  .sidebar {
    list-style: none;
    padding: 0;
    margin: 0;
    max-height: calc(100vh - 5rem);
    overflow-y: auto;
  }

  .sidebar li {
    margin-bottom: 1rem;
    display: flex;
    justify-content: end;
  }

  .sidebar a {
    text-decoration: none;
    color: #333;
  }

  .sidebar a:hover {
    color: #0077cc;
  }
</style>
